{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Practical Session: Microbiome Analysis","text":""},{"location":"#part-1","title":"Part 1:","text":""},{"location":"#introduction-to-the-study","title":"Introduction to the study","text":"<p>The composition of our microbiome is not static; it is shaped by various internal and external factors throughout life, from birth to adulthood. Early influences include\u00a0genetics, and even birth mode, which help establish a diverse microbiota. As we grow,\u00a0factors such as diet, exercises\u00a0continue to modify microbial communities. This study focuses on a life-limiting genetic disease typically diagnosed by age two.</p> <p>Cystic fibrosis unfolds as a story of resilience against a genetic adversity, where the mutation in the CFTR gene ,that maintains the balance of salt and water across cell membranes,results in an overproduction of thick, sticky mucus that obstructs the lungs and obstruct the pancreas. For patients, this means a struggle to breathe and a battle against frequent lung infections.</p> <p></p> <p>Figure 1: Mutations in the CFTR gene, thick and sticky mucus production</p> <p></p> <p></p>"},{"location":"#role-of-the-microbiota","title":"Role of the microbiota","text":"<p>Tracking of the lower respiratory tract microbiota stands as a critical tool in this struggle, offering deep insights into the lung's microbial landscape. Because in CF, the diversity of the microbial community in the lungs can change significantly with different stages of the disease. Normally, a diverse microbiome in the lungs is associated with better respiratory health. Healthy lungs\u00a0contain a\u00a0diverse and balanced microbiota, mostly dominated by anaerobes and commensal bacteria such as Veillonella, and Prevotella and is like an island whose population is determined by balance of immigration and elimination of species. </p> <p>In CF lungs, the thick mucus provides an ideal environment for opportunistic bacteria and pathogens to colonize. As the disease progresses and repeated antibiotic treatments are administered, microbial diversity decreases. In the early stages, Staphylococcus aureus and Haemophilus species are commonly found, but later, colonization by Pseudomonas and the formation of a thick biofilm layer make sputum clearance and treatment significantly more difficult. </p> <p>The\u00a0Climax-Attack Model (CAM) in CF explains the dynamic changes in airway microbiota.</p> <p></p> <p>Figure 2: Microbiome shifts in CF</p> <p></p> <p></p> <p>By understanding these microbial profiles and their shift in disease stages, physicians can customize treatments, adjusting antibiotics to stop infections from developing or spreading, keeping an eye on emerging drug resistances, and ultimately enhancing the quality of life for those with cystic fibrosis. </p> <p></p>"},{"location":"#surveillance-in-cf","title":"Surveillance in CF","text":"<ol> <li>Cinical Monitoring: Regular clinic visits for physical examinations</li> <li>Microbiological Monitoring: Regular collection of expectorated sputum and bronchoalveolar lavage (BAL) and analysing by microbial culture to identify bacteria or fungi that may be present in the lungs.</li> </ol>"},{"location":"#problem-statement","title":"Problem Statement:","text":"<p>It is relatively difficult to collect BAL and sputum in pediatric setting as children often do not have the ability to expectorate sputum because they either swallow it or do not understand how to cough it up effectively when requested.</p> <p></p>"},{"location":"#aim-of-the-study","title":"Aim of the study","text":"<p>Evaluating non-invasive respiratory sampling methods for young children in medical settings</p> <p>\"Can throat swabs serve as an effective alternative to sputum for the longitudinal assessment of lung microbial diversity and pathogen identification in patients who cannot expectorate?\"</p> <p></p> <p></p> <p></p> <ol> <li>Is the bacterial diversity in throat swab samples similar to that in sputum samples?</li> <li>Is the bacterial composition of throat swabs similar to that of sputum samples?</li> <li>Can throat swabs detect microbial shifts associated with CF exacerbations as effectively as sputum samples?</li> <li>How efficient are throat swabs in detecting known pathogens in CF patients compared to sputum samples?</li> </ol> <p></p>"},{"location":"#study-design","title":"Study design","text":"<p>Traditional culture techniques have been the cornerstone of microbiological monitoring in cystic fibrosis (CF), but they come with certain limitations. Some bacteria are hard to culture, or they grow too slowly to be detected promptly, and cultures may miss many non-culturable or fastidious organisms. That's where 16S amplicon-based metagenomics adds significant value. </p> <p>Figure 3: Study design and sample collection</p> <p></p> <p></p>"},{"location":"#part-2","title":"Part 2:","text":""},{"location":"#methods","title":"Methods","text":"<p>Amplicon-based metagenomics is a method focused on the amplification and sequencing of specific genomic regions, most often targeting the 16S rRNA genes that is ubiquitous in prokaryotes and hence allows to identify the members of a bacterial community. Each 16S rRNA gene has an approximate length of 1600 base pairs and includes nine hypervariable regions of varying conservation (V1-V9) interspersed by conserved sequences. Primers are designed on conserved sequences to allow the amplification of a maximum of bacterial and archaeal taxa, in our case on both side of the V3-V4 region. This strategy allows for short read sequencing of the amplicons and hence maximizes cost efficiency while minimizing technical challenges associated with amplification and analysis.</p> <p>Overall, the variable regions of the 16S rRNA gene present sufficient sequence diversity to differentiate between microbial Genera, and often even at the Species level. The selection of a reference database for taxonomical annotation significantly impacts the quality of the prediction and the taxonomical resolution.</p> <p>After sequencing, raw reads were processed using zAMP, a DADA2-based bioinformatics pipeline.</p> <p></p> <p>Figure 4: 16S amplicon-based metagenomics workflow</p> <p></p> <p> </p> <p>Figure 5: DADA2 workflow</p> <p></p> <p> </p> Code <pre><code># Call phyloseq library\nlibrary(phyloseq)\n#Read phyloseq object from the folder\nphyloseq &lt;- readRDS(\"/path_to_your_folder/base_with_tree.rds\")\n\n#Subset only paired sputum and throat swab samples collected in the same day of the visit from phyloseq that contains samples of full cohort\nphyloseq_pairs &lt;- prune_samples(x = phyloseq, as.character(metadata_pairs$Sample))\n\n# Remove taxa with 0 counts\nphyloseq_pairs &lt;- prune_taxa(taxa_sums(phyloseq_pairs) &gt; 0, phyloseq_pairs)\n\n#Extract bacterial abundance table from phyloseq object\nCount_table &lt;- data.frame(otu_table(phyloseq_pairs))\n#Extract metadata table from phyloseq object\nmetadata &lt;- data.frame(sample_data(phyloseq_pairs))\n#Extract taxonomy table table from phyloseq object\ntaxonomy_table &lt;- data.frame(tax_table(phyloseq_pairs))\n</code></pre> <p></p> <p>Figure 6: Structure of data in phyloseq</p> <p></p> <p></p>"},{"location":"#part-3","title":"Part 3:","text":""},{"location":"#analysis","title":"Analysis","text":"<p>Question 1</p> <p>Is the bacterial diversity in throat swab samples similar to that in sputum samples? Does this similarity changes by patient's exacerbation?</p> Code <pre><code># Call required libraries\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(stringr)\nlibrary(readxl)\nlibrary(gridExtra)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(cowplot)\nlibrary(vegan)\nlibrary(RColorBrewer)\nlibrary(microbiome)\nlibrary(pairwiseAdonis)\nlibrary(randomcoloR)\n\n# Function to process phyloseq and plot alpha diversity\nAlpha_diversity &lt;- function(phyloseq, output_folder) {\n\n# Calculate alpha diversity indices\ntab &lt;- microbiome::alpha(phyloseq, index = \"all\")\n\n# Add diversity indices to sample metadata\nps1_meta &lt;- sample_data(phyloseq)\nps1_meta$Shannon &lt;- tab$diversity_shannon\nps1_meta$chao1 &lt;- tab$chao1\nsample_data(phyloseq) &lt;- ps1_meta\n\n# Ensure Sample_type or your sample_group column in metadata is a factor and create color mapping\nps1_meta$Sample_type &lt;- factor(ps1_meta$Sample_type)\nsample_types &lt;- levels(ps1_meta$Sample_type)\nn_colors &lt;- length(sample_types)\ncolors &lt;- brewer.pal(min(n_colors, 8), \"Dark2\")\n# Adjust palette based on number of groups that you have\nif (n_colors &gt; 8) {  # Cycle through colors if more than 8 groups\ncolors &lt;- rep(colors, length.out = n_colors)\n}\ncolor_map &lt;- setNames(colors, sample_types)\n\n\n# Create combinations for pairwise comparisons\nbmi.pairs &lt;- combn(Sample_type, 2, simplify = FALSE, FUN = function(i) Sample_type[i])\n\n# Plotting function\nplot_alpha_diversity &lt;- function(index_name, x_label, y_label) {\nmicrobiome::boxplot_alpha(phyloseq, index = index_name, x_var = \"Sample_type\",\n                          violin = FALSE, show.points = TRUE, zeroes = TRUE,\n                          outlier.fill = \"white\",\n                          fill.colors = color_map) +\ntheme_minimal() +\nlabs(x = x_label, y = y_label) +\ntheme(axis.text = element_text(size = 12),\n      axis.title = element_text(size = 16),\n      legend.position = \"top\") +\nylim(0, NA) +\nstat_compare_means(comparisons = bmi.pairs, paired = TRUE, label = \"p.format\", method =   \"wilcox.test\")\n}\n\n# Create plots\np1 &lt;- plot_alpha_diversity(\"Chao1\", \"Observed\")\np2 &lt;- plot_alpha_diversity(\"shannon\", \"Shannon\")\n\n# Combine and save plots\nfinal_plot &lt;- gridExtra::grid.arrange(p1, p2, ncol = 1)\noutput_filename &lt;- file.path(output_folder, \"Alpha_diversity.svg\")\nggsave(output_filename, final_plot, device = \"svg\", width = 7, height = 8, dpi = 300)\n}\n\n\n#Define output folder\noutput_folder &lt; \"path_to_your_output_folder\"\n\n# Example of using the function\nAlpha_diversity(phyloseq_pairs, output_folder)\n</code></pre> <p></p> <p>Figure 7: Microbiome diversity in throat swabs and sputum</p> <p></p> <p> </p> Answer <p>Chao1 Diversity Index: For both pulmonary exacerbations and regular follow-up, the p-values (0.69 and 0.78, respectively) suggest that the difference in the number of observed species between sputum and throat swabs is not statistically significant. This means that the throat swabs have a similar species richness to that of sputum samples for the patient.  Shannon Diversity Index: Similarly, the p-values (1 and 0.25) indicate no statistically significant difference in the microbial diversity of sputum versus throat swabs during both pulmonary exacerbations and regular follow-up.</p> <p>The clinical status during exacerbations, which is typically marked by increased symptoms and decreased lung function, does not seem to significantly affect the ability of throat swabs to capture microbial diversity.</p> <p>Question 2</p> <p>Is the bacterial composition of throat swabs similar to that of sputum samples?</p> Code <pre><code># Function to process phyloseq and plot beta diversity (Bray-Curtis/ Jaccard distance)\nBeta_diversity &lt;- function(phyloseq, output_folder, distance_methods) {\n\n# Aggregate to species level and normalize\nphyloseq_species &lt;- aggregate_taxa(phyloseq, \"Species\") %&gt;%\nmicrobiome::transform(\"compositional\")\n\n# Remove taxa with 0 counts\nphyloseq_species &lt;- prune_taxa(taxa_sums(phyloseq_species) &gt; 0, phyloseq_species)\n\n# Extract count table for distance calculations\notu.tab &lt;- data.frame(t(otu_table(phyloseq_species)))\n\n# Extract top 10 taxa for plot\ntop10 &lt;- microbiome::top_taxa(phyloseq_species, 10)\nphyseq10.com &lt;- subset_taxa(phyloseq_species, Species %in% top10)\nphyseq10.com &lt;- t(physeq10.com@otu_table)\n#Replace NAs in the count table with zeros to avoid calculation errors\nphyseq10.com[is.na(physeq10.com)] = 0\ntop10Species &lt;- colnames(physeq10.com)\n\nplots &lt;- list()\nfor (method in distance_methods) {\n# Calculate Jaccard and Bray-Curtis distances between samples\ndistance &lt;- vegdist(otu.tab, method = ifelse(method == \"jaccard\", \"jaccard\", \"bray\"), binary = (method == \"jaccard\"))\n###If the method variable equals \"jaccard\", then it uses \"jaccard\"; otherwise, it defaults to \"bray\".\n\n#Set seed for reproducibility in NMDS\nset.seed(42)\n\n# NMDS ordination on the Jaccard and/or Bray-Curtis distance matrix\nnmds_g &lt;- metaMDS(distance)\n\n# Extract NMDS scores for each sample and merge them with metadata\ndata.scores_g &lt;- as.data.frame(scores(nmds_g, display = \"sites\"))\n#Remove any rows with missing data to avoid errors in plotting\ndata.scores_g &lt;- na.omit(data.scores_g)\n#Extract metadata from the phyloseq object\nmeta_g &lt;- data.frame(sample_data(phyloseq_P_species))\ndata.scores_g &lt;- merge(data.scores_g, meta_g, by = 0, all = TRUE)\n\n#Clean up row names after merging\nrow.names(data.scores_g) &lt;- data.scores_g$Row.names\ndata.scores_g &lt;- data.scores_g[, !(names(data.scores_g) %in% c(\"Row.names\"))]\n\n# Fit top species vectors to the NMDS\nen_g &lt;- envfit(nmds_g, physeq10.com, permutations = 999)\nen_coord_cont_g &lt;- as.data.frame(scores(en_g, \"vectors\"))\n\n#Calculate median coordinates of NMDS for each sample type to find the centroid\ncent_g &lt;- aggregate(cbind(NMDS1, NMDS2) ~ Sample_type, data = data.scores_g, FUN = median)\ncent_g$Sample_type &lt;- factor(cent_g$Sample_type, levels = names(colorCode))\n\n#Store the stress value of the NMDS for reporting\nstress &lt;-round(nmds_g$stress, digits = 2)\n\n#Calculate the average age for each patient and merge with the main data frame\naverage_ages &lt;- aggregate(Age ~ patient, data = data.scores_g, FUN = mean)\ndata.scores_g &lt;- merge(data.scores_g, average_ages, by = \"patient\")\n#Round the average age values to a whole number\ndata.scores_g$Age.y &lt;- round(data.scores_g$Age.y)\n# Define color code based on sample groups dynamically\nsample_types &lt;- levels(factor(data.scores_g$Sample_type))\ncolors &lt;- brewer.pal(min(length(sample_types), 8), \"Dark2\")\nif (length(sample_types) &gt; 8) {\ncolors &lt;- rep(colors, length.out = length(sample_types))\n}\ncolorCode &lt;- setNames(colors, sample_types)\n\n# Plotting NMDS with ggplot2\nNMDS_plot &lt;- ggplot(data = data.scores_g, aes(x = NMDS1, y = NMDS2, colour = Sample_type)) +\ngeom_point(aes(shape = Sample_type, size = Age.y), alpha = 0.7)+  #Plot points with size mapped to average age\ngeom_vline(xintercept = c(0), color = \"grey70\", linetype = \"longdash\", size =0.3) + #Add vertical line at x=0 for reference\ngeom_hline(yintercept = c(0), color = \"grey70\", linetype = \"longdash\", size =0.3) + #Add horizontal line at y=0 for reference\ngeom_point(data=cent_g, aes(x = NMDS1, y = NMDS2, colour = Sample_type), shape = 16, size = 4, alpha = 0.5) + #Plot centroids for sample types\nscale_color_manual(values = colorCode)+  #Set custom colors for sample type\nscale_size_continuous(name = \"Average Age\")+  #Add a legend for point sizes (average age)\nstat_ellipse(geom = \"polygon\",aes(fill = Sample_type), alpha = 0.15, linetype = 2) + #Add ellipses to group samples by type\ngeom_segment(aes(x = 0, y = 0, xend = NMDS1*1, yend = NMDS2*1), arrow = arrow(length = unit(0.1, \"cm\")),\ndata = en_coord_cont_g, size =0.2, alpha = 0.5, colour = \"black\", linetype = 2) + #Draw vectors for species\ngeom_text_repel(data = en_coord_cont_g, aes(x = NMDS1*1, y = NMDS2*1),  #Add species names with labels\ncolour = \"black\", fontface = \"bold\", label = row.names(en_coord_cont_g), size=3)+\nscale_fill_manual(values=colorCode)+\ntheme(plot.title = element_text(size = 9),\nplot.subtitle = element_text(size = 9))+\ngeom_point(alpha = 0.7) +\nscale_color_manual(values = colorCode) +\ntheme_bw() + #Apply a theme with a white background\nlabs(title = \"NMDS using \" + method + \" distance\")\n\n# Save the plot\noutput_filename &lt;- file.path(output_folder, paste(\"NMDS_\", method, \"_Plot.svg\", sep=\"\"))\nggsave(output_filename, NMDS_plot, device = \"svg\", width = 10)\n}\n}\n\n# Read phyloseq object from the path\nphyloseq &lt;- readRDS(\"path_to_your_folder/base_with_tree.rds\")\n\n#Define output folder\noutput_folder &lt; \"path_to_your_output_folder\"\n\ndistance_methods = c(\"bray\", \"jaccard\")\n\n# Example of using the function\nBeta_diversity(phyloseq_pairs, output_folder, distance_methods)\n</code></pre> <p></p> <p>Figure 8: Comparison of microbiome composition between throat swabs and sputum</p> <p></p> <p> </p> Answer <p>Based on the provided Non-metric Multidimensional Scaling (NMDS) plots which compare beta diversity of microbial communities from sputum and throat swab samples using Bray-Curtis and Jaccard distances, here\u2019s an interpretation:</p> <p>NMDS Plot with Bray-Curtis- abundance of bacteria (Left side):</p> <ul> <li>Stress: 0.22 (Acceptable: &lt; 0.2 is ideal, but &lt; 0.3 is considered a good representation of data in ecological studies).</li> <li>PERMANOVA: 0.001 (The low p-value indicates that there are significant differences in microbial composition between sputum and throat swab samples).</li> <li>The ellipses that represent the 95% confidence areas for the sputum (green) and throat swabs (orange) are somewhat overlapping, yet distinct, which suggests there is some similarity but also notable differences in microbial composition between the two sample types.</li> </ul> <p>NMDS Plot with Jaccard distance- presecne/absence of bacteria (right side):</p> <ul> <li>Stress: 0.15 (Considered a good representation).</li> <li>PERMANOVA: 0.54 (The high p-value suggests there is no significant difference in community membership - simply which organisms are present or absent, not their abundances - between the two sample types).</li> <li>The ellipses overlap more here compared to the Bray-Curtis plot, indicating a greater similarity in presence/absence data of the species sampled in throat swabs and sputum.</li> </ul> <p>The significant result in the Bray-Curtis NMDS indicates differences in the abundance of species, while the non-significant Jaccard result suggests that the same species are present in both sample types.   These findings could imply that while the types of bacteria present in throat swabs and sputum are similar (species membership), the proportions (abundance) of these bacteria differ, which is clinically relevant as abundance can influence disease state and treatment response.</p> <p>Bonus question</p> <p>How does the age of a patient appear to influence the microbial community composition in the respiratory tract, based on the beta diversity shown in the NMDS plots for both sputum and throat swab samples?</p> <p>Question 3</p> <p>Can throat swabs detect microbial shifts associated with CF exacerbations as effectively as sputum samples?</p> <p>Figure 9: Comparison of microbiome composition between throat swabs and sputum in exacerbation phase</p> <p></p> <p> </p> Answer <p>The statistical test suggests that in the exacerbation phase, the sample type (sputum vs. throat swab) does not significantly affect the microbial composition within the same visits, with p-values of 0.12 and 0.58 for Bray-Curtis and Jaccard distances respectively. However, the timing of the visit influences bacterial abundance, as indicated by the significant p-value of 0.04 for Bray-Curtis distance, suggesting that factors related to individual visits (such as disease state, treatment, or environmental conditions) may play a more significant role than the type of sample collected. let's discover this in next question.</p> <p>Question 4</p> <p>Do sputum and throat swab samples cluster more strongly by sample type or patient identity? What might this indicate about the nature of airway microbiota in children with CF?</p> Answer <p>Samples clustered by the individuals rather than by the sample type (pairwise PERMANOVA, p = 0.001). This suggests that each patient harbors a unique, individual-specific microbiota in their airways that is more consistent across different sample types (sputum vs. throat swab) than across individuals. This could reflect personal environmental exposure, genetic background, or medical treatment history.</p> <p></p> <p>Figure 10: Microbial community composition clusters by patient identity rather than sample type</p> <p></p> <p> </p> <p>Question 5</p> <p>How efficient are throat swabs in detecting known pathogens in CF patients compared to sputum samples?</p> Code <pre><code>#Code for looking into the abundance of pathogen of interest in each sample group\n# 1) Read phyloseq object in R\n# 2) Transform it to phyloseq with relative abundances\n# 3) subset your pathogen of interest (you can use subset_taxa() function)\n# 4) Use aggregate_taxa() to have phyloseq with species level\n\n# list of pathogen of interest:\n# - Pseudomonas aeruginosa\n# - Staphylococcus aureus\n# - Achromobacter_sp\n# - Haemophilus influenzae\n# - Moraxella nonliquefaciens\n# - Stenotrophomonas_sp\n\n# phyloseq_species was normalised to relative abundances and aggregated to species level\nps_pathogen &lt;- subset_taxa(phyloseq_species, Species %in% c(\"Pseudomonas aeruginosa\",\n                          \"Staphylococcus aureus\",\n                          \"Achromobacter_sp\",\n                          \"Haemophilus influenzae\",\n                          \"Moraxella nonliquefaciens\",\n                          \"Stenotrophomonas_sp\"))\n\n#melt the phyloseq object\nPS_abund_melt &lt;- psmelt(ps_pathogen)\n\n#now sum up all ASVs from same sequencing run that assigned to the same species\ncolnames(PS_abund_melt)\n\nPS_SumASV &lt;- PS_abund_melt %&gt;%\n            group_by(Sample, sample_types, patient, visit, patient_visit, Species) %&gt;%\n            summarise_at(vars(Abundance),  # Specify column\n            list(Abundance_sum = sum))\n\n#final table to use with pathogens of interest\nFinal_table &lt;- PS_SumASV[PS_SumASV$Species %in% c (\"Pseudomonas aeruginosa\",\n                                                            \"Staphylococcus aureus\",\n                                                            \"Achromobacter_sp\",\n                                                            \"Haemophilus influenzae\",\n                                                            \"Moraxella nonliquefaciens\",\n                                                            \"Stenotrophomonas_sp\"), ]\ntable(Final_table$Species, Final_table$patient_visit)\n\n## plot Heatmaps\n\nPathogen_table &lt;- ggplot(Final_table, aes(x= sample_types, y= Species, fill= Abundance_sum)) +\n  geom_tile() +\n  facet_grid(~ patient_visit) +\n  scale_fill_viridis(discrete=FALSE, name=\"Abundance (%)\") +\n  xlab(label = \"Sample\")+\n  theme(axis.text.x=element_text(angle=90, hjust=1),\n        strip.text.x = element_text(angle = 90, hjust=1)) +\n  coord_equal()\n\nggsave(Pathogen_table, filename = \"heatmap_patientvisit.jpeg\", height=4, width=12, dpi = 300)\n</code></pre> <p></p> <p>Figure 11: Validity of throat swabs for pathogen detection compared to sputum &gt; </p> Answer <p>Pathogen presence: For each pathogen listed on the y-axis, you can see whether it was detected (green) or not detected (white) in each type of sample during various patient visits (shown on the x-axis).</p> <p>Sample comparison: By comparing the green bars for each pathogen in sputum versus throat swabs across patient visits, you can assess whether throat swabs consistently show the presence of these pathogens as often as sputum samples do.</p> <p>Detection consistency: Consistent detection in both sample types across multiple patient visits would suggest throat swabs are as efficient as sputum samples in detecting these pathogens. Conversely, if certain pathogens are frequently present in sputum samples but not in throat swabs, it could indicate that throat swabs may miss some pathogens that are detectable in sputum.</p> <p>Pathogen-specific efficiency: The efficiency of throat swabs may vary for different pathogens. For example, if Staphylococcus aureus is consistently detected in both sputum and throat swabs, but Pseudomonas aeruginosa is often missed in throat swabs, this would indicate pathogen-specific differences in detection efficiency.</p> <p>How you would conclude?</p>"}]}